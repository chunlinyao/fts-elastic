{
    "settings": {
      "number_of_shards": 10,
      "number_of_replicas": 0,
      "analysis": {
        "normalizer": {
          "lowercase": {
            "type": "custom",
            "char_filter": [],
            "filter": ["lowercase"]
          }
        },
        "char_filter": {
          "remove_email_address": {
            "type": "pattern_replace",
            "pattern": "(<[^>]*>)",
            "replacement": " "
          },
          "normalize": {
		   "type": "icu_normalizer",
		   "name": "nfkc",
		   "mode": "compose"
          }
        },
        "filter": {
          "email": {
            "type": "pattern_capture",
            "preserve_original": true,
            "max_token_length": 64,
            "patterns": [
              "([^@]+)",
              "(\\p{L}+)",
              "(\\d+)",
              "@(.+)",
              "([^-@]+)"
            ]
          },
          "max50char": {
            "type": "length",
            "min": 2,
            "max": 50
          },
          "limit2000": {
            "type": "limit",
            "max_token_count": 2000
          },
	  "ja_index_synonym": {
          "type": "synonym",
          "lenient": false,
          "synonyms": [
          ]
        },
        "ja_search_synonym": {
          "type": "synonym_graph",
          "lenient": false,
          "synonyms": [
            "米国, アメリカ",
            "東京大学, 東大"
          ]
        }
        },
        "tokenizer": {
          "email_address": {
            "type": "pattern",
            "pattern": "<([^>]+)>",
            "group": 1
          },
        "ja_kuromoji_tokenizer": { 
          "mode": "search", 
          "type": "kuromoji_tokenizer", 
          "discard_compound_token": true
        }
        },
        "analyzer": {
          "body": {
		 "char_filter": ["normalize", "kuromoji_iteration_mark"],
            "tokenizer": "ik_max_word",
            "filter": ["asciifolding", "lowercase", "unique", "max50char", "limit2000"]
          },
          "body_search": {
		 "char_filter": ["normalize", "kuromoji_iteration_mark"],
            "tokenizer": "ik_smart",
            "filter": ["asciifolding", "lowercase", "unique", "max50char", "limit2000"]
          },
          "ja_body": {
		 "type": "custom",
		 "char_filter": ["normalize", "kuromoji_iteration_mark"],
            "tokenizer": "ja_kuromoji_tokenizer",
            "filter": ["kuromoji_baseform", "kuromoji_part_of_speech", "ja_index_synonym", "cjk_width", "ja_stop", "kuromoji_stemmer", "asciifolding", "lowercase", "unique", "max50char", "limit2000"]
          },
          "ja_body_search": {
		 "type": "custom",
		 "char_filter": ["normalize", "kuromoji_iteration_mark"],
            "tokenizer": "ja_kuromoji_tokenizer",
            "filter": ["kuromoji_baseform", "kuromoji_part_of_speech", "ja_search_synonym", "cjk_width", "ja_stop", "kuromoji_stemmer", "asciifolding", "lowercase", "unique", "max50char", "limit2000"]
          },
          "email": {
            "tokenizer": "uax_url_email",
            "filter": ["asciifolding", "email", "lowercase", "unique"]
          },
          "email_name": {
            "tokenizer": "standard",
            "filter": ["asciifolding", "lowercase", "unique"],
            "char_filter": ["remove_email_address"]
          },
          "email_address": {
            "tokenizer": "email_address",
            "filter": ["email", "lowercase", "unique"]
          }
        }
      }
    },
    "mappings": {
      "_source":  {
        "enabled": true
      },
      "properties": {
        "user":   {"type": "keyword", "normalizer": "lowercase"},
        "box":    {"type": "keyword", "normalizer": "lowercase"},
        "uid":    {"type": "integer"},
        "subject":{"type": "text", "analyzer": "body", "search_analyzer": "body_search",
			"fields": {
				"japanese" : {"type": "text", "analyzer": "ja_body", "search_analyzer": "ja_body_search"}
			}},
        "body":   {"type": "text", "analyzer": "body", "search_analyzer": "body_search",
			"fields": {
				"japanese" : {"type": "text", "analyzer": "ja_body", "search_analyzer": "ja_body_search"}
			}},
        "message-id":{"type": "keyword"},
        "date": {
          "type": "date",
          "format": "[EEE, ][ ]d MMM yyyy HH:mm:ss[ Z][ (z)]"
        },
        "from": {
          "type": "text", "analyzer": "email",
          "fields": {
            "name":    {"type": "text", "analyzer": "email_name"},
            "address": {"type": "text", "analyzer": "email_address"}
          }
        },
        "sender": {
          "type": "text", "analyzer": "email",
          "fields": {
            "name":    {"type": "text", "analyzer": "email_name"},
            "address": {"type": "text", "analyzer": "email_address"}
          }
        },
        "to":     {
          "type": "text", "analyzer": "email",
          "fields": {
            "name":    {"type": "text", "analyzer": "email_name"},
            "address": {"type": "text", "analyzer": "email_address"}
          }
        },
        "cc":     {
          "type": "text", "analyzer": "email",
          "fields": {
            "name":    {"type": "text", "analyzer": "email_name"},
            "address": {"type": "text", "analyzer": "email_address"}
          }
        },
        "bcc":    {
          "type": "text", "analyzer": "email",
          "fields": {
            "name":    {"type": "text", "analyzer": "email_name"},
            "address": {"type": "text", "analyzer": "email_address"}
          }
        }
      }
    }
  }
